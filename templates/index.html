<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Map Dashboard</title>
    <style>
        #map {
            height: 100%;
            width: 70%;
            float: right;
        }
        #sidebar {
            height: 100%;
            width: 30%;
            float: left;
            background-color: #f0f0f0;
            padding: 10px;
            overflow-y: auto;
        }
        body {
            margin: 0;
            display: flex;
            height: 100vh;
        }
    </style>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css"/>
</head>
<body>
    <div id="sidebar">
        <h2>Location Information</h2>
        <p>Select an area on the map to see details here.</p>
    </div>
    <div id="map">
        {% include 'map.html' %}
    </div>
    
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var map = L.map('map').setView([37.7749, -122.4194], 13);

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);

            var drawnItems = new L.FeatureGroup();
            map.addLayer(drawnItems);

            var drawControl = new L.Control.Draw({
                edit: {
                    featureGroup: drawnItems
                }
            });
            map.addControl(drawControl);

            map.on('draw:created', function (e) {
                var type = e.layerType,
                    layer = e.layer;

                drawnItems.addLayer(layer);

                var coords = layer.getLatLngs();

                // Make AJAX POST request to Flask server
                fetch('/get_area_info', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ coords: coords })
                })
                .then(response => response.json())
                .then(data => {
                    document.getElementById('sidebar').innerHTML = `
                        <h2>Location Information</h2>
                        <p><strong>Area:</strong> ${data.Area}</p>
                        <p><strong>Population:</strong> ${data.Population}</p>
                        <p><strong>Average Income:</strong> ${data['Average Income']}</p>
                        <p><strong>Other Info:</strong> ${data['Other Info']}</p>
                    `;
                });
            });
        });
    </script>
</body>
</html>
